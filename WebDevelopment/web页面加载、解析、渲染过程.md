# 一、浏览器
浏览器的主要功能是将用户选择的web资源呈现出来，它需要从服务器请求资源，并将其显示在浏览器窗口中，资源的格式通常是HTML，也包括PDF、image及其他格式。用户用URI（Uniform Resource Identifier统一资源标识符）来指定所请求资源的位置，通过DNS查询，将网址转换为IP地址。整个浏览器工作的流程： 

1. 输入网址。 
2. 浏览器查找域名的IP地址。 
3. 浏览器给web服务器发送一个HTTP请求 
4. 网站服务的永久重定向响应 
5. 浏览器跟踪重定向地址 现在，浏览器知道了要访问的正确地址，所以它会发送另一个获取请求。 
6. 服务器“处理”请求，服务器接收到获取请求，然后处理并返回一个响应。 
7. 服务器发回一个HTML响应 
8. 浏览器开始显示HTML 
9. 浏览器发送请求，以获取嵌入在HTML中的对象。在浏览器显示HTML时，它会注意到需要获取其他地址内容的标签。这时，浏览器会发送一个获取请求来重新获得这些文件。这些文件就包括CSS/JS/图片等资源，这些资源的地址都要经历一个和HTML读取类似的过程。所以浏览器会在DNS中查找这些域名，发送请求，重定向等；

#### 浏览器的主要组件包括

1. 用户界面： 包括地址栏、后退/前进按钮、书签目录等，也就是你所看到的除了用来显示你所请求页面的主窗口之外的其他部分；
2. 浏览器引擎：用来查询及操作渲染引擎的接口；
3. 渲染引擎： 用来显示请求的内容，例如，如果请求内容为html，它负责解析html及css，并将解析后的结果显示出来；
4. 网络：用来完成网络调用，例如http请求，它具有平台无关的接口，可以在不同平台上工作；
5. UI 后端：用来绘制类似组合选择框及对话框等基本组件，具有不特定于某个平台的通用接口，底层使用操作系统的用户接口；
6. JS解释器：用来解释执行JS代码；
7. 数据存储：H5定义了web database技术，这是一种轻量级完整的客户端存储技术；

# 二、页面生成过程

1. DNS服务器通过域名查找对应的web 服务器ip地址；
2. 浏览器访问web服务器；这里涉及到客户端与服务器的tcp 三次握手与四次挥手，可以参考上篇博文《TCP的三次握手(建立连接）与 四次挥手(关闭连接）》；
3. 服务器处理完成返回html;
4. 浏览器解析、加载页面 : 解析html 构建dom树 -> 构建render树 -> 布局render树 -> 绘制render树 

<img src="https://images2015.cnblogs.com/blog/825196/201703/825196-20170328150055436-1910402537.png">

我们知道浏览器为了体验友好，并不是文档全部都解析才绘制到屏幕上，而是从上至下开始解析html，遇到css 会开启线程下载css；

#### 解析：

1. 将HTML构建成一个DOM树（DOM = Document Object Model 文档对象模型），DOM 树的构建过程是一个深度遍历过程：当前节点的所有子节点都构建好后才会去构建当前节点的下一个兄弟节点。 
2. 将CSS解析成CSS去构造CSSOM树( CSSOM = CSS Object Model CSS对象模型)
3. 根据DOM树和CSSOM来构造 Rendering Tree（渲染树）。注意：Rendering Tree 渲染树并不等同于 DOM 树，因为一些像 Header 或 display:none 的东西就没必要放在渲染树中了。
4. 有了Render Tree，浏览器已经能知道网页中有哪些节点、各个节点的CSS定义以及他们的从属关系。
5. 下一步操作称之为Layout，顾名思义就是计算出每个节点在屏幕中的位置 layout render tree。 
6. 再下一步就是绘制，即遍历render树，并使用浏览器UI后端层绘制每个节点。  

性能优化中重绘、重排： 

1. Reflow（回流/重排）：当它发现了某个部分发生了变化影响了布局，渲染树需要重新计算。 
2. Repaint（重绘）：改变了某个元素的背景颜色，文字颜色等，不影响元素周围或内部布局的属性，将只会引起浏览器的repaint，根据元素的新属性重新绘制，使元素呈现新的外观。重绘不会带来重新布局，并不一定伴随重排；  

Reflow要比Repaint更花费时间，也就更影响性能。所以在写代码的时候，要尽量避免过多的Reflow。

reflow的原因：

1. 页面初始化的时候； 
2. 操作DOM时； 
3. 某些元素的尺寸变了； 
4. 如果 CSS 的属性发生变化了。 

减少 reflow/repaint

1. 不要一条一条地修改 DOM 的样式。与其这样，还不如预先定义好 css 的 class，然后修改 DOM 的 className。 
2. 不要把 DOM 结点的属性值放在一个循环里当成循环里的变量。 
3. 为动画的 HTML 元件使用 fixed 或 absoult 的 position，那么修改他们的 CSS 是不会 reflow 的。 
4. 千万不要使用 table 布局。因为可能很小的一个小改动会造成整个 table 的重新布局。  

# 三、影响页面渲染

#### css注意事项

css选择符是从右到左进行匹配的。所以，#nav li 我们以为这是一条很简单的规则，秒秒钟就能匹配到想要的元素，所以，会去找所有的li，然后再去确定它的父元素是不是#nav。因此，写css的时候需要注意：

1. dom深度尽量浅。
2. 减少inline javascript、css的数量。
3. 使用现代合法的css属性。
4. 不要为id选择器指定类名或是标签，因为id可以唯一确定一个元素。
5. 避免后代选择符，尽量使用子选择符。原因：子元素匹配符的概率要大于后代元素匹配符。后代选择符;#tp p{} 子选择符：#tp>p{}
6. 避免使用通配符，举一个例子，.mod .hd *{font-size:14px;} 根据匹配顺序,将首先匹配通配符,也就是说先匹配出通配符,然后匹配.hd（就是要对dom树上的所有节点进行遍历他的父级元素）,然后匹配.mod,这样的性能耗费可想而知.  

#### javascript 位置

如果在解析html的时候遇到js会阻塞页面渲染，所以一般我们会将所有的script标签放到页面底部，也就是body闭合标签之前，这能确保在脚本执行前页面已经完成了DOM树渲染。尽可能地合并脚本。页面中的script标签越少，加载也就越快，响应也越迅速。无论是外链脚本还是内嵌脚本都是如此。

采用无阻塞下载 JavaScript 脚本的方法： 
1. 使用script标签的 defer、async 属性、； 
2. 使用动态创建的script元素来下载并执行代码等异步加载等方法；

